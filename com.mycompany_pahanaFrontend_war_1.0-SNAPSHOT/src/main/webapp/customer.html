<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pahana Edu Customer Management</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-4">
    <h1 class="text-3xl font-bold text-center mb-6">Pahana Edu Customer Management</h1>

    <div id="message" class="hidden p-4 mb-4 rounded text-white text-center"></div>

    <!-- Add Customer Form -->
    <div id="addCustomerContainer" class="bg-white p-6 rounded shadow-md mb-6">
      <h2 class="text-2xl font-semibold mb-4">Add New Customer</h2>
      <form id="addCustomerForm" class="space-y-4">
        <input type="number" id="accountNumber" placeholder="Account Number" class="p-2 w-full border rounded" required />
        <input type="text" id="name" placeholder="Name" class="p-2 w-full border rounded" required />
        <input type="text" id="address" placeholder="Address" class="p-2 w-full border rounded" />
        <input type="text" id="telephone" placeholder="Telephone" class="p-2 w-full border rounded" />
        <input type="email" id="email" placeholder="Email" class="p-2 w-full border rounded" />
        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded">Add Customer</button>
      </form>
    </div>

    <!-- Update Customer Form -->
    <div id="updateCustomerContainer" class="hidden bg-white p-6 rounded shadow-md mb-6">
      <h2 class="text-2xl font-semibold mb-4">Update Customer</h2>
      <form id="updateCustomerForm" class="space-y-4">
        <input type="hidden" id="updateAccountNumber" />
        <input type="text" id="updateName" placeholder="Name" class="p-2 w-full border rounded" required />
        <input type="text" id="updateAddress" placeholder="Address" class="p-2 w-full border rounded" />
        <input type="text" id="updateTelephone" placeholder="Telephone" class="p-2 w-full border rounded" />
        <input type="email" id="updateEmail" placeholder="Email" class="p-2 w-full border rounded" />
        <div class="flex gap-2">
          <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">Update</button>
          <button type="button" id="cancelUpdate" class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">Cancel</button>
        </div>
      </form>
    </div>

    <!-- Customer Table -->
    <div class="bg-white p-6 rounded shadow-md">
      <h2 class="text-2xl font-semibold mb-4">Customer List</h2>
      <table class="w-full border">
        <thead class="bg-gray-200">
          <tr>
            <th class="p-2 border">Account #</th>
            <th class="p-2 border">Name</th>
            <th class="p-2 border">Address</th>
            <th class="p-2 border">Telephone</th>
            <th class="p-2 border">Email</th>
            <th class="p-2 border">Actions</th>
          </tr>
        </thead>
        <tbody id="customerTableBody"></tbody>
      </table>
    </div>
  </div>

  <script>
    const apiUrl = "http://localhost:8080/pahanaBackend/resources/customers";

    function showMessage(message, isError = false) {
      const msg = document.getElementById("message");
      msg.textContent = message;
      msg.className = `p-4 mb-4 rounded text-white text-center ${isError ? "bg-red-600" : "bg-green-600"}`;
      msg.classList.remove("hidden");
      setTimeout(() => msg.classList.add("hidden"), 3000);
    }

    async function loadCustomers() {
      try {
        const res = await fetch(apiUrl);
        if (!res.ok) throw new Error("Failed to load customers");
        const data = await res.json();
        const tbody = document.getElementById("customerTableBody");
        tbody.innerHTML = "";
        data.forEach(c => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td class="p-2 border">${c.accountNumber}</td>
            <td class="p-2 border">${c.name}</td>
            <td class="p-2 border">${c.address || ""}</td>
            <td class="p-2 border">${c.telephone || ""}</td>
            <td class="p-2 border">${c.email || ""}</td>
            <td class="p-2 border text-center">
              <button onclick="editCustomer(${c.accountNumber})" class="bg-yellow-500 hover:bg-yellow-600 text-white px-2 py-1 rounded">Edit</button>
              <button onclick="deleteCustomer(${c.accountNumber})" class="bg-red-600 hover:bg-red-700 text-white px-2 py-1 rounded ml-2">Delete</button>
            </td>
          `;
          tbody.appendChild(row);
        });
      } catch (error) {
        showMessage(error.message, true);
      }
    }

    document.getElementById("addCustomerForm").addEventListener("submit", async e => {
      e.preventDefault();
      const customer = {
        accountNumber: parseInt(document.getElementById("accountNumber").value),
        name: document.getElementById("name").value,
        address: document.getElementById("address").value,
        telephone: document.getElementById("telephone").value,
        email: document.getElementById("email").value,
      };

      try {
        const res = await fetch(apiUrl, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(customer),
        });
        const result = await res.json();
        if (!res.ok) throw new Error(result.error || "Error adding customer");
        showMessage("Customer added successfully");
        document.getElementById("addCustomerForm").reset();
        loadCustomers();
      } catch (err) {
        showMessage(err.message, true);
      }
    });

    async function deleteCustomer(accountNumber) {
      if (!confirm("Are you sure you want to delete this customer?")) return;
      try {
        const res = await fetch(`${apiUrl}/${accountNumber}`, { method: "DELETE" });
        const result = await res.json();
        if (!res.ok) throw new Error(result.error || "Error deleting customer");
        showMessage("Customer deleted successfully");
        loadCustomers();
      } catch (err) {
        showMessage(err.message, true);
      }
    }

    async function editCustomer(accountNumber) {
      try {
        const res = await fetch(`${apiUrl}/${accountNumber}`);
        if (!res.ok) throw new Error("Failed to fetch customer");
        const c = await res.json();

        document.getElementById("updateAccountNumber").value = c.accountNumber;
        document.getElementById("updateName").value = c.name;
        document.getElementById("updateAddress").value = c.address || "";
        document.getElementById("updateTelephone").value = c.telephone || "";
        document.getElementById("updateEmail").value = c.email || "";

        document.getElementById("addCustomerContainer").classList.add("hidden");
        document.getElementById("updateCustomerContainer").classList.remove("hidden");
      } catch (err) {
        showMessage(err.message, true);
      }
    }

    document.getElementById("cancelUpdate").addEventListener("click", () => {
      document.getElementById("updateCustomerContainer").classList.add("hidden");
      document.getElementById("addCustomerContainer").classList.remove("hidden");
    });

    document.getElementById("updateCustomerForm").addEventListener("submit", async e => {
      e.preventDefault();
      const customer = {
        accountNumber: parseInt(document.getElementById("updateAccountNumber").value),
        name: document.getElementById("updateName").value,
        address: document.getElementById("updateAddress").value,
        telephone: document.getElementById("updateTelephone").value,
        email: document.getElementById("updateEmail").value,
      };

      try {
        const res = await fetch(`${apiUrl}/${customer.accountNumber}`, {
          method: "PUT",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(customer),
        });
        const result = await res.json();
        if (!res.ok) throw new Error(result.error || "Error updating customer");
        showMessage("Customer updated successfully");
        document.getElementById("cancelUpdate").click();
        loadCustomers();
      } catch (err) {
        showMessage(err.message, true);
      }
    });

    // Load initial customers
    loadCustomers();
  </script>
</body>
</html>
