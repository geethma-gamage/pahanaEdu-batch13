<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pahana Edu Item Management</title>
 
</head>
<body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
        <h1 class="text-3xl font-bold text-center mb-6">Pahana Edu Item Management</h1>

        <!-- Error/Success Message -->
        <div id="message" class="hidden p-4 mb-4 rounded text-white"></div>

        <!-- Add Item Form -->
        <div class="bg-white p-6 rounded shadow-md mb-6">
            <h2 class="text-2xl font-semibold mb-4">Add New Item</h2>
            <form id="addItemForm" class="space-y-4">
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-700">Item Name</label>
                    <input type="text" id="name" name="name" class="mt-1 p-2 w-full border rounded" required>
                </div>
                <div>
                    <label for="category" class="block text-sm font-medium text-gray-700">Category</label>
                    <input type="text" id="category" name="category" class="mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label for="price" class="block text-sm font-medium text-gray-700">Price</label>
                    <input type="number" id="price" name="price" step="0.01" class="mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label for="quantity" class="block text-sm font-medium text-gray-700">Quantity</label>
                    <input type="number" id="quantity" name="quantity" class="mt-1 p-2 w-full border rounded">
                </div>
                <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Add Item</button>
            </form>
        </div>

        <!-- Update Item Form (Hidden by default) -->
        <div id="updateItemFormContainer" class="hidden bg-white p-6 rounded shadow-md mb-6">
            <h2 class="text-2xl font-semibold mb-4">Update Item</h2>
            <form id="updateItemForm" class="space-y-4">
                <input type="hidden" id="updateId" name="id">
                <div>
                    <label for="updateName" class="block text-sm font-medium text-gray-700">Item Name</label>
                    <input type="text" id="updateName" name="name" class="mt-1 p-2 w-full border rounded" required>
                </div>
                <div>
                    <label for="updateCategory" class="block text-sm font-medium text-gray-700">Category</label>
                    <input type="text" id="updateCategory" name="category" class="mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label for="updatePrice" class="block text-sm font-medium text-gray-700">Price</label>
                    <input type="number" id="updatePrice" name="price" step="0.01" class="mt-1 p-2 w-full border rounded">
                </div>
                <div>
                    <label for="updateQuantity" class="block text-sm font-medium text-gray-700">Quantity</label>
                    <input type="number" id="updateQuantity" name="quantity" class="mt-1 p-2 w-full border rounded">
                </div>
                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Update Item</button>
                <button type="button" id="cancelUpdate" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">Cancel</button>
            </form>
        </div>

        <!-- Items Table -->
        <div class="bg-white p-6 rounded shadow-md">
            <h2 class="text-2xl font-semibold mb-4">Items List</h2>
            <table id="itemsTable" class="w-full border-collapse">
                <thead>
                    <tr class="bg-gray-200">
                        <th class="p-2 border">ID</th>
                        <th class="p-2 border">Name</th>
                        <th class="p-2 border">Category</th>
                        <th class="p-2 border">Price</th>
                        <th class="p-2 border">Quantity</th>
                        <th class="p-2 border">Actions</th>
                    </tr>
                </thead>
                <tbody id="itemsTableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        const apiBaseUrl = 'http://localhost:8080/pahanaBackend/resources/items'; // Adjust to your API base URL

        // Display message
        function showMessage(message, isError = false) {
            const messageDiv = document.getElementById('message');
            messageDiv.textContent = message;
            messageDiv.classList.remove('hidden', 'bg-green-500', 'bg-red-500');
            messageDiv.classList.add(isError ? 'bg-red-500' : 'bg-green-500');
            setTimeout(() => messageDiv.classList.add('hidden'), 3000);
        }

        // Fetch and display all items
        async function fetchItems() {
            try {
                const response = await fetch(apiBaseUrl);
                if (!response.ok) throw new Error('Failed to fetch items');
                const items = await response.json();
                const tableBody = document.getElementById('itemsTableBody');
                tableBody.innerHTML = '';
                items.forEach(item => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-2 border">${item.id}</td>
                        <td class="p-2 border">${item.name}</td>
                        <td class="p-2 border">${item.category || ''}</td>
                        <td class="p-2 border">${item.price ? item.price.toFixed(2) : ''}</td>
                        <td class="p-2 border">${item.quantity || ''}</td>
                        <td class="p-2 border">
                            <button onclick="editItem(${item.id})" class="bg-yellow-500 text-white px-2 py-1 rounded hover:bg-yellow-600">Edit</button>
                            <button onclick="deleteItem(${item.id})" class="bg-red-500 text-white px-2 py-1 rounded hover:bg-red-600">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            } catch (error) {
                showMessage(error.message, true);
            }
        }

        // Add item
        document.getElementById('addItemForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const item = {
                name: formData.get('name'),
                category: formData.get('category') || null,
                price: parseFloat(formData.get('price')) || null,
                quantity: parseInt(formData.get('quantity')) || null
            };

            try {
                const response = await fetch(apiBaseUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(item)
                });
                const result = await response.json();
                if (response.ok) {
                    showMessage('Item added successfully');
                    e.target.reset();
                    fetchItems();
                } else {
                    showMessage(result.error || 'Failed to add item', true);
                }
            } catch (error) {
                showMessage(error.message, true);
            }
        });

        // Edit item
        async function editItem(id) {
            try {
                const response = await fetch(`${apiBaseUrl}/${id}`);
                if (!response.ok) throw new Error('Failed to fetch item');
                const item = await response.json();
                document.getElementById('updateId').value = item.id;
                document.getElementById('updateName').value = item.name;
                document.getElementById('updateCategory').value = item.category || '';
                document.getElementById('updatePrice').value = item.price || '';
                document.getElementById('updateQuantity').value = item.quantity || '';
                document.getElementById('updateItemFormContainer').classList.remove('hidden');
                document.getElementById('addItemForm').classList.add('hidden');
            } catch (error) {
                showMessage(error.message, true);
            }
        }

        // Update item
        document.getElementById('updateItemForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const formData = new FormData(e.target);
            const item = {
                id: parseInt(formData.get('id')),
                name: formData.get('name'),
                category: formData.get('category') || null,
                price: parseFloat(formData.get('price')) || null,
                quantity: parseInt(formData.get('quantity')) || null
            };

            try {
                const response = await fetch(`${apiBaseUrl}/${item.id}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(item)
                });
                const result = await response.json();
                if (response.ok) {
                    showMessage(result.message || 'Item updated successfully');
                    document.getElementById('updateItemFormContainer').classList.add('hidden');
                    document.getElementById('addItemForm').classList.remove('hidden');
                    fetchItems();
                } else {
                    showMessage(result.error || 'Failed to update item', true);
                }
            } catch (error) {
                showMessage(error.message, true);
            }
        });

        // Cancel update
        document.getElementById('cancelUpdate').addEventListener('click', () => {
            document.getElementById('updateItemFormContainer').classList.add('hidden');
            document.getElementById('addItemForm').classList.remove('hidden');
        });

        // Delete item
        async function deleteItem(id) {
            if (!confirm('Are you sure you want to delete this item?')) return;
            try {
                const response = await fetch(`${apiBaseUrl}/${id}`, {
                    method: 'DELETE'
                });
                const result = await response.json();
                if (response.ok) {
                    showMessage(result.message || 'Item deleted successfully');
                    fetchItems();
                } else {
                    showMessage(result.error || 'Failed to delete item', true);
                }
            } catch (error) {
                showMessage(error.message, true);
            }
        }

        // Initial fetch
        fetchItems();
    </script>
</body>
</html>